<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/product/">
    <title>Reporte productos</title>
    <!--Icono Pestaña-->
    <link rel="shortcut icon" href="../img/LogoWind.png" type="image/x-icon">
    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Estilos -->
    <link href="estilos.css" rel="stylesheet">
    <link href="AnimacionLogo/estilos2.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  </head>

  <body>

    <!--NAVBAR-->
    <header class="site-header sticky-top py-1">
      <nav class="navbar navbar-expand-lg">
          <div class="container-fluid">
              <a href="#sobre_n" class="navbar-brand d-lg-flex" aria-label="Logo">
                  <img src="../img/LogoWind.png" width="50em" height="50em">
              </a>
              <button class="navbar-toggler me-2" type="button" data-bs-toggle="collapse"
                  data-bs-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false"
                  aria-label="Toggle navigation">
                  <img src="../img/menui.png" alt="" width="40em" height="50em">
              </button>
              <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
                  

                  <ul class="navbar-nav me-auto mb-2 mb-lg-0 d-lg-flex d-sm-inline d-md-inline">
                      <li class="nav-item">
                          <a class="nav-link" aria-current="page" href="index.html">Inicio</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" aria-current="page"
                              href="../vista/index.html#caract">Caracteristicas</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="../vista/index.html#planes_precios">Planes y precios</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="../vista/index.html#soporte">Soporte</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="../vista/index.html#sobre_n">Empresa</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="./productos.html">Productos</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="./movimientos.html">Movimientos</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" data-bs-toggle="modal" data-bs-target="#staticBackdrop">Contacto</a>
                      </li>
                      <li class="nav-item">
                          <div class="dropdown">
                            <button class="btn btn_registrar2 dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                              Reportes
                            </button>
                            <ul class="dropdown-menu bg-dark text-light" aria-labelledby="dropdownMenuButton1">
                              <li><a class="dropdown-item" href="#">Action</a></li>
                              <li><a class="dropdown-item" href="./Reporte_Productos.html">Productos vendidos</a></li>
                              <li><a class="dropdown-item" href="./Reporte_Top5_Productos.html">Top 5 productos</a></li>
                            </ul>
                          </div>
                        </li>
                  </ul>
                  <div class="d-flex">
                      <a href="../vista/Registro.html"><button type="button"
                              class="btn btn-lg btn_registrar">Registrarse</button></a>
                  </div>
              </div>
          </div>
      </nav>
  </header>

  <div class="m-0 row justify-content-center">
    <div class="col-auto p-2 text-center">
      Top 5 productos más vendidos por trimestre 
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-12 col-lg-6 mb-3">
        <label for="ano" class="form-label">Año</label>
        <select class="form-select" id="ano" name="ano">
          <option value="1996" selected>1996</option>
          <option value="1997">1997</option>
          <option value="1998">1998</option>
      </select>
      </div>
      <div class="col-12 col-lg-6 mb-3">
        <label for="trimestre" class="form-label">Trimestre</label>
        <select class="form-select" id="trimestre" name="trimestre">
          <option value="01" selected>1</option>
          <option value="02">2</option>
          <option value="03">3</option>
          <option value="04">4</option>
      </select>
      </div>
    </div>
    <button id="btnEnv" class="btn btn-success" onclick="cargarDatos()">Generar reporte</button>
  </div>

  <div id="contenedor" class="visible invisible">
    <div class="ima_fondo"></div>
    <img src="AnimacionLogo/imgs/Elices.png" width="200px" height="209px"  class="img_elices" alt="">
    <img src="AnimacionLogo/imgs/Letras.png" width="200px" height="215px"  class="img_letras" alt="">
  
</div>
    <!--Div that will hold the dashboard-->
    <div id="dashboard_div">
      <!--Divs that will hold each control and chart-->
      <div id="columnchart_values"></div>
      <script type="text/javascript">

      $(document).ajaxStart(function() {
        $("#contenedor").addClass('visible');
      });

      $(document).ajaxStop(function() {
        $("#contenedor").removeClass('visible');
      });

        // Load the Visualization API and the controls package.
        google.charts.load('current', {'packages':['corechart']});
  
        // Set a callback to run when the Google Visualization API is loaded.
        //google.charts.setOnLoadCallback(cargarDatos);

       
  
        function cargarDatos() {

          var anio = document.getElementById("ano").value;
          var trim = document.getElementById("trimestre").value;


          const carga = document.getElementById("contenedor");
          
            fetch('https://localhost:44379/api/Employees/productos_trim?ano='+anio+'&trimestre='+trim+'')
                .then(response => response.json())
                .then(data => drawChart(data))
                .catch(error => console.error('Unable to get items.', error));
        }
  
        // Callback that creates and populates a data table,
        // instantiates a dashboard, a range slider and a pie chart,
        // passes in the data and draws it.
        function drawChart(productos) {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'producto');
        data.addColumn('number','cantidad');
        var arr = [];
          productos.forEach(element => {
              
                arr.push([element.producto, element.cantidad]);
          });

          console.log(arr.slice(0,5));
          data.addRows(arr);

  
                  var view = new google.visualization.DataView(data);
        

        var anio = document.getElementById("ano").value;
        var trim = document.getElementById("trimestre").value;
  
        var options = {
          title: "Top 5 de productos más vendidos en el trimestre "+trim+ " del año "+anio+"",
          width: 800,
          height: 600,
          bar: {groupWidth: "95%"},
        };
        var chart = new google.visualization.ColumnChart(document.getElementById("columnchart_values"));
        chart.draw(data, options);
    }
      </script>
       <!-- Bootstrap Bundle with Popper -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"></script>
      
    </div>
  </body>
</html>